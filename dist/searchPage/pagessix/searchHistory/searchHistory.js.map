{"version":3,"sources":["searchPage/pagessix/searchHistory/searchHistory.js"],"names":["app","getApp","Page","data","title","keyWord","searchShow","onShareAppMessage","gs","t","path","imageUrl","g","getKey","that","wxrequest","url","getUrl","homeSearch","success","res","wx","hideLoading","status","setData","options","type","setToast","content","msg","cleanHistory","history","removeStorageSync","chooseTip","e","index","currentTarget","dataset","choose","keyWordIndex","search","chooseHistory","searcheText","detail","value","question","dotSearch","courseSearch","activeSearch","Object","assign","page","ask","dot_name","total","searchText","setTimeout","navigateTo","navigateBack","count","unshift","pop","setStorage","key","getStorageSync","getHot","hideLaoding","desc","onLoad","setBar","onReady","onShow","onHide","onUnload","onPullDownRefresh"],"mappings":"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","file":"searchHistory.js","sourcesContent":["// 获取全局应用程序实例对象\nconst app = getApp()\n\n// 创建页面实例对象\nPage({\n  /**\n   * 页面的初始数据\n   */\n  data: {\n    title: 'searchHistory',\n    keyWord: [1, 23, 4],\n    searchShow: true\n  },\n  onShareAppMessage () {\n    return {\n      title: app.gs('shareText').t || '绣学问，真纹绣',\n      path: `/pages/index/index`,\n      imageUrl: app.gs('shareText').g\n    }\n  },\n  getKey () {\n    let that = this\n    app.wxrequest({\n      url: app.getUrl().homeSearch,\n      data: {},\n      success (res) {\n        wx.hideLoading()\n        if (res.data.status === 200) {\n          that.setData({\n            keyWord: res.data.data[that.data.options.type]\n          })\n        } else {\n          app.setToast(that, {content: res.data.msg})\n        }\n      }\n    })\n  },\n  cleanHistory () {\n    this.setData({\n      history: [],\n      searchShow: false\n    })\n    if (this.data.options.type === 'goods') {\n      wx.removeStorageSync('goodsHistory')\n    } else {\n      wx.removeStorageSync('articleHistory')\n    }\n  },\n  chooseTip (e) {\n    let index = e.currentTarget.dataset.choose\n    if (e.currentTarget.dataset.type === 'key') {\n      this.setData({\n        keyWordIndex: index\n      }, this.search(e.currentTarget.dataset.content))\n    } else {\n      this.setData({\n        chooseHistory: index\n      }, this.search(e.currentTarget.dataset.content))\n    }\n  },\n  search (content) {\n    // return\n    let that = this\n    // console.log(content)\n    let searcheText = ''\n    if (content.detail) searcheText = content.detail.value\n    else searcheText = content\n    app.wxrequest({\n      url: that.data.options.type === 'question' ? app.getUrl().question : that.data.options.type === 'store' ? app.getUrl().dotSearch : that.data.options.type === 'course' ? app.getUrl().courseSearch : that.data.options.type === 'offline' ? app.getUrl().activeSearch : '',\n      data: Object.assign({\n        page: 1\n      }, that.data.options.type === 'question' ? {ask: searcheText} : that.data.options.type === 'store' ? {dot_name: searcheText} : (that.data.options.type === 'course' || that.data.options.type === 'offline') ? {title: searcheText} : {}),\n      success (res) {\n        wx.hideLoading()\n        if (res.data.status === 200 && res.data.data.total > 0) {\n          app.data.searchText = searcheText\n          setTimeout(() => {\n            that.data.options.type === 'course' ? wx.navigateTo({\n              url: '/coursePage/pageszero/course/course?type=search'\n            }) : wx.navigateBack()\n          }, 20)\n        } else {\n          app.setToast(that, {content: '未搜索到相关内容'})\n        }\n      }\n    })\n    // 设置缓存\n    for (let index in that.data.history) {\n      // 搜索项已经存在\n      if (that.data.history[index] === searcheText) {\n        // console.log(index)\n        that.setData({\n          chooseHistory: index\n        })\n        // that.getSearch(that.data.history[index])\n        return\n      }\n    }\n    let history = that.data.history\n    // console.log(history)\n    if (!history) {\n      history = [searcheText]\n      that.data.history = history\n    } else {\n      let count = history.unshift(searcheText)\n      if (count >= 10) {\n        that.data.history.pop()\n      }\n    }\n    this.setData({\n      chooseHistory: 0,\n      searchShow: true\n    })\n    // 执行搜索操作\n    // this.getSearch(searcheText)\n    let type = that.data.options.type === 'goods' ? 'goodsHistory' : 'articleHistory'\n    wx.setStorage({\n      key: type,\n      data: that.data.history,\n      success () {\n        that.setData({\n          history: wx.getStorageSync(type)\n        })\n      }\n    })\n  },\n  getHot () {\n    let that = this\n    app.wxrequest({\n      url: app.getUrl().search,\n      data: {},\n      success (res) {\n        wx.hideLaoding()\n        if (res.data.status === 200) {\n\n        } else {\n          app.setToast(that, {content: res.data.desc})\n        }\n      }\n    })\n  },\n  /**\n   * 生命周期函数--监听页面加载\n   */\n  onLoad (options) {\n    app.setBar('搜索')\n    // app.getSelf(this)\n    let history = options.type === 'goods' ? app.gs('goodsHistory') : app.gs('articleHistory')\n    if (!history) {\n      this.setData({\n        searchShow: false\n      })\n    }\n    this.setData({\n      options,\n      history: history || []\n    }, this.getKey)\n    // TODO: onLoad\n  },\n\n  /**\n   * 生命周期函数--监听页面初次渲染完成\n   */\n  onReady () {\n    // TODO: onReady\n  },\n\n  /**\n   * 生命周期函数--监听页面显示\n   */\n  onShow () {\n    // TODO: onShow\n  },\n\n  /**\n   * 生命周期函数--监听页面隐藏\n   */\n  onHide () {\n    // TODO: onHide\n  },\n\n  /**\n   * 生命周期函数--监听页面卸载\n   */\n  onUnload () {\n    // TODO: onUnload\n  },\n\n  /**\n   * 页面相关事件处理函数--监听用户下拉动作\n   */\n  onPullDownRefresh () {\n    // TODO: onPullDownRefresh\n  }\n})\n"]}