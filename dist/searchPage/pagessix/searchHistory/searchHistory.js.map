{"version":3,"sources":["searchPage/pagessix/searchHistory/searchHistory.js"],"names":["app","getApp","Page","data","title","keyWord","searchShow","onShareAppMessage","gs","path","getKey","that","wxrequest","url","getUrl","homeSearch","success","res","wx","hideLoading","status","setData","options","type","setToast","content","msg","cleanHistory","history","removeStorageSync","chooseTip","e","index","currentTarget","dataset","choose","keyWordIndex","search","chooseHistory","searcheText","detail","value","question","dotSearch","courseSearch","activeSearch","Object","assign","page","ask","dot_name","total","searchText","setTimeout","navigateTo","navigateBack","count","unshift","pop","setStorage","key","getStorageSync","getHot","hideLaoding","desc","onLoad","setBar","onReady","onShow","onHide","onUnload","onPullDownRefresh"],"mappings":"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","file":"searchHistory.js","sourcesContent":["// 获取全局应用程序实例对象\nconst app = getApp()\n\n// 创建页面实例对象\nPage({\n  /**\n   * 页面的初始数据\n   */\n  data: {\n    title: 'searchHistory',\n    keyWord: [1, 23, 4],\n    searchShow: true\n  },\n  onShareAppMessage () {\n    return {\n      title: app.gs('shareText') || '绣学问，真纹绣',\n      path: `/pages/index/index`\n    }\n  },\n  getKey () {\n    let that = this\n    app.wxrequest({\n      url: app.getUrl().homeSearch,\n      data: {},\n      success (res) {\n        wx.hideLoading()\n        if (res.data.status === 200) {\n          that.setData({\n            keyWord: res.data.data[that.data.options.type]\n          })\n        } else {\n          app.setToast(that, {content: res.data.msg})\n        }\n      }\n    })\n  },\n  cleanHistory () {\n    this.setData({\n      history: [],\n      searchShow: false\n    })\n    if (this.data.options.type === 'goods') {\n      wx.removeStorageSync('goodsHistory')\n    } else {\n      wx.removeStorageSync('articleHistory')\n    }\n  },\n  chooseTip (e) {\n    let index = e.currentTarget.dataset.choose\n    if (e.currentTarget.dataset.type === 'key') {\n      this.setData({\n        keyWordIndex: index\n      }, this.search(e.currentTarget.dataset.content))\n    } else {\n      this.setData({\n        chooseHistory: index\n      }, this.search(e.currentTarget.dataset.content))\n    }\n  },\n  search (content) {\n    // return\n    let that = this\n    // console.log(content)\n    let searcheText = ''\n    if (content.detail) searcheText = content.detail.value\n    else searcheText = content\n    app.wxrequest({\n      url: that.data.options.type === 'question' ? app.getUrl().question : that.data.options.type === 'store' ? app.getUrl().dotSearch : that.data.options.type === 'course' ? app.getUrl().courseSearch : that.data.options.type === 'offline' ? app.getUrl().activeSearch : '',\n      data: Object.assign({\n        page: 1\n      }, that.data.options.type === 'question' ? {ask: searcheText} : that.data.options.type === 'store' ? {dot_name: searcheText} : (that.data.options.type === 'course' || that.data.options.type === 'offline') ? {title: searcheText} : {}),\n      success (res) {\n        wx.hideLoading()\n        if (res.data.status === 200 && res.data.data.total > 0) {\n          app.data.searchText = searcheText\n          setTimeout(() => {\n            that.data.options.type === 'course' ? wx.navigateTo({\n              url: '/coursePage/pageszero/course/course?type=search'\n            }) : wx.navigateBack()\n          }, 20)\n        } else {\n          app.setToast(that, {content: '未搜索到相关内容'})\n        }\n      }\n    })\n    // 设置缓存\n    for (let index in that.data.history) {\n      // 搜索项已经存在\n      if (that.data.history[index] === searcheText) {\n        // console.log(index)\n        that.setData({\n          chooseHistory: index\n        })\n        // that.getSearch(that.data.history[index])\n        return\n      }\n    }\n    let history = that.data.history\n    // console.log(history)\n    if (!history) {\n      history = [searcheText]\n      that.data.history = history\n    } else {\n      let count = history.unshift(searcheText)\n      if (count >= 10) {\n        that.data.history.pop()\n      }\n    }\n    this.setData({\n      chooseHistory: 0,\n      searchShow: true\n    })\n    // 执行搜索操作\n    // this.getSearch(searcheText)\n    let type = that.data.options.type === 'goods' ? 'goodsHistory' : 'articleHistory'\n    wx.setStorage({\n      key: type,\n      data: that.data.history,\n      success () {\n        that.setData({\n          history: wx.getStorageSync(type)\n        })\n      }\n    })\n  },\n  getHot () {\n    let that = this\n    app.wxrequest({\n      url: app.getUrl().search,\n      data: {},\n      success (res) {\n        wx.hideLaoding()\n        if (res.data.status === 200) {\n\n        } else {\n          app.setToast(that, {content: res.data.desc})\n        }\n      }\n    })\n  },\n  /**\n   * 生命周期函数--监听页面加载\n   */\n  onLoad (options) {\n    app.setBar('搜索')\n    // app.getSelf(this)\n    let history = options.type === 'goods' ? app.gs('goodsHistory') : app.gs('articleHistory')\n    if (!history) {\n      this.setData({\n        searchShow: false\n      })\n    }\n    this.setData({\n      options,\n      history: history || []\n    }, this.getKey)\n    // TODO: onLoad\n  },\n\n  /**\n   * 生命周期函数--监听页面初次渲染完成\n   */\n  onReady () {\n    // TODO: onReady\n  },\n\n  /**\n   * 生命周期函数--监听页面显示\n   */\n  onShow () {\n    // TODO: onShow\n  },\n\n  /**\n   * 生命周期函数--监听页面隐藏\n   */\n  onHide () {\n    // TODO: onHide\n  },\n\n  /**\n   * 生命周期函数--监听页面卸载\n   */\n  onUnload () {\n    // TODO: onUnload\n  },\n\n  /**\n   * 页面相关事件处理函数--监听用户下拉动作\n   */\n  onPullDownRefresh () {\n    // TODO: onPullDownRefresh\n  }\n})\n"]}