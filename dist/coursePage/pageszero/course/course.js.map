{"version":3,"sources":["coursePage/pageszero/course/course.js"],"names":["app","getApp","page","Page","data","tabNav","label","lists","currentIndex","onShareAppMessage","title","gs","t","path","imageUrl","g","chooseIndex","e","setBar","currentTarget","dataset","text","setData","index","getList","getOfflineList","that","wxrequest","url","getUrl","activeNearby","longitude","options","lng","latitude","lat","code","adcode","parent_code","pages","success","res","wx","hideLoading","status","total","v","s","distance","toFixed","setToast","content","desc","type","courseSearch","course","searchText","concat","more","pre_page","length","onReachBottom","onLoad","onReady","onShow","onHide","onUnload","onPullDownRefresh"],"mappings":"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","file":"course.js","sourcesContent":["// 获取全局应用程序实例对象\nconst app = getApp()\nlet page = 0\n// 创建页面实例对象\nPage({\n  /**\n   * 页面的初始数据\n   */\n  data: {\n    tabNav: app.data.label,\n    lists: [],\n    page: 0,\n    currentIndex: 0\n  },\n  onShareAppMessage () {\n    return {\n      title: app.gs('shareText').t || '绣学问，真纹绣',\n      path: `/pages/index/index`,\n      imageUrl: app.gs('shareText').g\n    }\n  },\n  chooseIndex (e) {\n    app.setBar(e.currentTarget.dataset.text)\n    this.data.lists = []\n    this.data.page = 0\n    page = 0\n    this.setData({\n      currentIndex: e.currentTarget.dataset.index\n    }, this.getList)\n    // wx.pageScrollTo({\n    //   scrollTop: 0\n    // })\n  },\n  getOfflineList () {\n    let that = this\n    app.wxrequest({\n      url: app.getUrl().activeNearby,\n      data: {\n        label: app.data.label[that.data.currentIndex].label,\n        longitude: that.data.options.lng,\n        latitude: that.data.options.lat,\n        code: that.data.options.adcode,\n        parent_code: that.data.parent_code ? 1 : 0,\n        pages: ++this.data.page\n      },\n      success (res) {\n        wx.hideLoading()\n        if (res.data.status === 200) {\n          if (res.data.data.total < 1 && !that.data.parent_code) {\n            that.data.parent_code = 1\n            that.data.page <= 1 ? that.data.page = 0 : null\n            that.getOfflineList()\n          } else {\n            for (let v of res.data.data.lists) {\n              for (let s of v.lists) {\n                s.distance = s.distance > 1000 ? (s.distance / 1000).toFixed(2) + 'km' : s.distance + 'm'\n              }\n            }\n            that.setData({\n              lists: res.data.data.lists\n            })\n          }\n        } else {\n          app.setToast(that, {content: res.data.desc})\n        }\n      }\n    })\n  },\n  getList () {\n    if (this.data.options.type * 1 === 2) return this.getOfflineList()\n    let that = this\n    app.wxrequest({\n      url: that.data.options.type === 'search' ? app.getUrl().courseSearch : app.getUrl().course,\n      data: that.data.options.type === 'search' ? {\n        page: ++page,\n        title: that.data.searchText\n      } : {\n        label: app.data.label[that.data.currentIndex].label,\n        page: ++page\n      },\n      success (res) {\n        wx.hideLoading()\n        if (res.data.status === 200) {\n          that.setData({\n            lists: that.data.lists.concat(res.data.data.lists),\n            more: res.data.data.pre_page > res.data.data.lists.length ? 0 : 1\n          })\n        } else {\n          app.setToast(that, {content: res.data.desc})\n        }\n      }\n    })\n  },\n  onReachBottom () {\n    if (this.data.more >= 1) this.getList()\n    else app.setToast(this, {content: '没有更多内容啦'})\n  },\n  /**\n   * 生命周期函数--监听页面加载\n   */\n  onLoad (options) {\n    if (app.data.searchText) {\n      this.data.searchText = app.data.searchText\n      app.data.searchText = null\n    }\n    app.setBar(options.type === 'search' ? '搜索课程' : app.data.label[0].t)\n    page = 0\n    this.setData({\n      options,\n      tabNav: app.data.label\n    }, this.getList)\n    // TODO: onLoad\n  },\n\n  /**\n   * 生命周期函数--监听页面初次渲染完成\n   */\n  onReady () {\n    // TODO: onReady\n  },\n\n  /**\n   * 生命周期函数--监听页面显示\n   */\n  onShow () {\n    // TODO: onShow\n  },\n\n  /**\n   * 生命周期函数--监听页面隐藏\n   */\n  onHide () {\n    // TODO: onHide\n  },\n\n  /**\n   * 生命周期函数--监听页面卸载\n   */\n  onUnload () {\n    // TODO: onUnload\n  },\n\n  /**\n   * 页面相关事件处理函数--监听用户下拉动作\n   */\n  onPullDownRefresh () {\n    this.data.lists = []\n    page = 0\n    this.getList()\n    // TODO: onPullDownRefresh\n  }\n})\n"]}