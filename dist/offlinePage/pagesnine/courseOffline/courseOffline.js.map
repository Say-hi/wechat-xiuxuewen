{"version":3,"sources":["offlinePage/pagesnine/courseOffline/courseOffline.js"],"names":["app","getApp","bmap","require","Page","data","testImg","page","lists","title","onShareAppMessage","gs","t","path","imageUrl","g","open_site","e","console","log","detail","authSetting","wx","showToast","setData","openType","that","setTimeout","Bmap","choose_site","chooseLocation","success","res","address","latitude","longitude","site","BMap","BMapWX","ak","regeocoding","location","addressInfo","getNear","fail","searchText","search","wxrequest","url","getUrl","activeNearby","code","originalData","result","addressComponent","adcode","lng","lat","parent_code","user_id","id","hideLoading","status","total","v","s","distance","toFixed","setToast","content","desc","activeSearch","city_name","length","concat","more","pre_page","onReachBottom","onLoad","setBar","onReady","onShow","onHide","onUnload","onPullDownRefresh"],"mappings":"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","file":"courseOffline.js","sourcesContent":["// 获取全局应用程序实例对象\nconst app = getApp()\nconst bmap = require('../../../utils/bmap-wx')\n// 创建页面实例对象\nPage({\n  /**\n   * 页面的初始数据\n   */\n  data: {\n    testImg: app.data.testImg,\n    page: 0,\n    lists: [],\n    title: 'courseOffline'\n  },\n  onShareAppMessage () {\n    return {\n      title: app.gs('shareText').t || '绣学问，真纹绣',\n      path: `/pages/index/index`,\n      imageUrl: app.gs('shareText').g\n    }\n  },\n  /**\n   * 地址授权\n   * @param e\n   */\n  open_site (e) {\n    console.log('setting')\n    if (e.detail.authSetting['scope.userLocation']) {\n      wx.showToast({\n        title: '授权成功'\n      })\n      this.setData({\n        openType: null\n      })\n      let that = this\n      setTimeout(function () {\n        that.Bmap(that)\n      }, 100)\n    }\n  },\n  choose_site () {\n    console.log('choose')\n    let that = this\n    if (!this.data.openType) {\n      wx.chooseLocation({\n        success (res) {\n          that.setData({\n            address: res.address,\n            latitude: res.latitude,\n            longitude: res.longitude\n          }, that.Bmap(that, `${res.longitude},${res.latitude}`))\n        }\n      })\n    }\n  },\n  /**\n   * 百度地图函数\n   * @param that\n   * @constructor\n   */\n  Bmap (that, site) {\n    let BMap = new bmap.BMapWX({\n      ak: 'RBTsmFCaerZ25VkuGhpSIZa5lyC36BcV'\n    })\n    BMap.regeocoding({\n      location: site || null,\n      success (res) {\n        that.setData({\n          addressInfo: res,\n          page: 0\n        }, that.getNear)\n      },\n      fail (data) {\n        that.setData({\n          openType: 'openSetting'\n        })\n        console.log('fail', data)\n      }\n    })\n  },\n  getNear () {\n    if (this.data.searchText) return this.search()\n    let that = this\n    app.wxrequest({\n      url: app.getUrl().activeNearby,\n      data: {\n        code: that.data.addressInfo.originalData.result.addressComponent.adcode,\n        longitude: that.data.addressInfo.originalData.result.location.lng,\n        latitude: that.data.addressInfo.originalData.result.location.lat,\n        parent_code: that.data.parent_code || 0,\n        user_id: app.gs('userInfoAll').id,\n        page: ++that.data.page\n      },\n      success (res) {\n        wx.hideLoading()\n        if (res.data.status === 200) {\n          if (res.data.data.total < 1 && !that.data.parent_code) {\n            that.data.parent_code = 1\n            that.data.page <= 1 ? that.data.page = 0 : null\n            that.getNear()\n          } else {\n            for (let v of res.data.data.lists) {\n              for (let s of v.lists) {\n                s.distance = s.distance > 1000 ? (s.distance / 1000).toFixed(2) + 'km' : s.distance + 'm'\n              }\n            }\n            that.setData({\n              lists: res.data.data.lists\n            })\n          }\n        } else {\n          app.setToast(that, {content: res.data.desc})\n        }\n      }\n    })\n  },\n  // 搜索\n  search () {\n    let that = this\n    app.wxrequest({\n      url: app.getUrl().activeSearch,\n      data: {\n        page: ++that.data.page,\n        title: that.data.searchText\n      },\n      success (res) {\n        wx.hideLoading()\n        if (res.data.status === 200) {\n          for (let s of res.data.data.lists) {\n            s.distance = s.distance < 1 ? s.distance * 100 + 'm' : s.distance + 'km'\n          }\n          that.data.lists[0] = {\n            city_name: '搜索结果',\n            lists: !that.data.lists.length ? res.data.data.lists : that.data.lists[0].lists.concat(res.data.data.lists)\n          }\n          that.setData({\n            lists: that.data.lists,\n            more: res.data.data.pre_page > res.data.data.lists.length ? 0 : 1\n          })\n        } else {\n          app.setToast(that, {content: '未搜索到相关内容'})\n        }\n      }\n    })\n  },\n  onReachBottom () {\n    if (this.data.more > 0) this.getNear()\n    else app.setToast(this, {content: '没有更多内容啦'})\n  },\n  /**\n   * 生命周期函数--监听页面加载\n   */\n  onLoad () {\n    this.Bmap(this)\n    app.setBar('线下手把手教学')\n    // TODO: onLoad\n  },\n\n  /**\n   * 生命周期函数--监听页面初次渲染完成\n   */\n  onReady () {\n    // TODO: onReady\n  },\n\n  /**\n   * 生命周期函数--监听页面显示\n   */\n  onShow () {\n    if (app.data.searchText) {\n      this.data.page = 0\n      this.data.lists = []\n      this.data.searchText = app.data.searchText\n      app.data.searchText = null\n      this.getNear()\n    }\n    // TODO: onShow\n  },\n\n  /**\n   * 生命周期函数--监听页面隐藏\n   */\n  onHide () {\n    // TODO: onHide\n  },\n\n  /**\n   * 生命周期函数--监听页面卸载\n   */\n  onUnload () {\n    // TODO: onUnload\n  },\n\n  /**\n   * 页面相关事件处理函数--监听用户下拉动作\n   */\n  onPullDownRefresh () {\n    // TODO: onPullDownRefresh\n  }\n})\n"]}