{"version":3,"sources":["storePage/pagesstore/incomePage/income/income.js"],"names":["app","getApp","Page","data","title","openType","page","lists","testImg","upFormId","e","getList","that","wxrequest","url","getUrl","teacherUserIncome","user_id","gs","id","success","res","wx","hideLoading","status","v","create_time","momentFormat","setData","concat","more","pre_page","length","setToast","content","desc","onReachBottom","moneyOut","userInputMoney","teacherUserCash","openid","amount","showToast","moneyOperation","currentTarget","dataset","type","getRoomInfo","getMoneyShow","teacherDotDetail","putMoney","put_money","totalFee","total_fee","outMoney","console","log","detail","value","onLoad","setBar","onReady","onShow","onHide","onUnload","onPullDownRefresh"],"mappings":"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","file":"income.js","sourcesContent":["// 获取全局应用程序实例对象\nconst app = getApp()\n// 创建页面实例对象\nPage({\n  /**\n   * 页面的初始数据\n   */\n  data: {\n    title: 'collage',\n    openType: 'share',\n    page: 0,\n    lists: [],\n    testImg: app.data.testImg\n  },\n  upFormId (e) {\n    app.upFormId(e)\n  },\n  getList () {\n    let that = this\n    app.wxrequest({\n      url: app.getUrl().teacherUserIncome,\n      data: {\n        user_id: app.gs('userInfoAll').id,\n        page: ++that.data.page\n      },\n      success (res) {\n        wx.hideLoading()\n        if (res.data.status === 200) {\n          for (let v of res.data.data.lists) {\n            v.create_time = app.momentFormat(v.create_time * 1000, 'YYYY年MM月DD日 HH:SS')\n          }\n          that.setData({\n            lists: that.data.lists.concat(res.data.data.lists),\n            more: res.data.data.pre_page > res.data.data.lists.length ? 0 : 1\n          })\n        } else {\n          app.setToast(that, {content: res.data.desc})\n        }\n      }\n    })\n  },\n  onReachBottom () {\n    if (this.data.more >= 1) this.getList()\n    else app.setToast(this, {content: '没有更多内容啦'})\n  },\n  moneyOut () {\n    let that = this\n    if (that.data.userInputMoney <= 0.1) return app.setToast(this, {content: '提现金额不能小于0.1元'})\n    app.wxrequest({\n      url: app.getUrl().teacherUserCash,\n      data: {\n        user_id: app.gs('userInfoAll').id,\n        openid: app.gs(),\n        amount: that.data.userInputMoney\n      },\n      success (res) {\n        wx.hideLoading()\n        if (res.data.status === 200) {\n          wx.showToast({\n            title: '申请成功'\n          })\n          that.moneyOperation({\n            currentTarget: {\n              dataset: {\n                type: 'change'\n              }\n            }\n          })\n          that.getRoomInfo()\n        } else {\n          app.setToast(that, {content: res.data.desc})\n          that.moneyOperation({\n            currentTarget: {\n              dataset: {\n                type: 'change'\n              }\n            }\n          })\n          that.getRoomInfo()\n        }\n      }\n    })\n  },\n  moneyOperation (e) {\n    if (e.currentTarget.dataset.type === 'confirm') {\n      this.moneyOut()\n    } else {\n      this.setData({\n        getMoneyShow: !this.data.getMoneyShow\n      })\n    }\n  },\n  getRoomInfo () {\n    let that = this\n    app.wxrequest({\n      url: app.getUrl().teacherDotDetail,\n      data: {\n        user_id: app.gs('userInfoAll').id\n      },\n      success (res) {\n        wx.hideLoading()\n        if (res.data.status === 200) {\n          that.setData({\n            putMoney: res.data.data.put_money,\n            totalFee: res.data.data.total_fee\n          })\n        } else {\n          app.setToast(that, {content: res.data.desc})\n        }\n      }\n    })\n  },\n  outMoney (e) {\n    let that = this\n    console.log(e)\n    that.setData({\n      userInputMoney: e.detail.value * 1 > that.data.totalFee ? that.data.totalFee : e.detail.value\n    })\n  },\n  /**\n   * 生命周期函数--监听页面加载\n   */\n  onLoad () {\n    app.setBar('我的收益')\n    this.getList()\n    this.getRoomInfo()\n  },\n\n  /**\n   * 生命周期函数--监听页面初次渲染完成\n   */\n  onReady () {\n    // TODO: onReady\n  },\n\n  /**\n   * 生命周期函数--监听页面显示\n   */\n  onShow () {\n    // TODO: onShow\n  },\n\n  /**\n   * 生命周期函数--监听页面隐藏\n   */\n  onHide () {\n    // TODO: onHide\n  },\n\n  /**\n   * 生命周期函数--监听页面卸载\n   */\n  onUnload () {\n    // TODO: onUnload\n  },\n\n  /**\n   * 页面相关事件处理函数--监听用户下拉动作\n   */\n  onPullDownRefresh () {\n    this.data.page = 0\n    this.data.lists = []\n    this.getList()\n    // TODO: onPullDownRefresh\n  }\n})\n"]}