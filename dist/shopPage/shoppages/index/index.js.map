{"version":3,"sources":["shopPage/shoppages/index/index.js"],"names":["app","getApp","Page","data","img","testImg","labelIndex","inputValue","e","searchText","detail","value","getVideo","that","wxrequest","url","getUrl","shopVideoList","success","res","wx","hideLoading","stopPullDownRefresh","status","setData","list","lists","getCategory","setToast","content","desc","shopCategoryList","goodslabel","shopInfo","su","getShopProduct","noshop","name","search","shopProductList","mid","cid","id","goods","chooseLabel","currentTarget","dataset","index","length","title","unshift","gs","info","upFormId","noUse","playVideo","videoCount","play","playIndex","onShareAppMessage","t","path","imageUrl","g","avatar","getUser","shopUserInfo","uid","userInfo","showTip","showModal","showCancel","onLoad","options","wxlogin","onReady","onShow","move","onHide","onUnload","onPullDownRefresh"],"mappings":"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","file":"index.js","sourcesContent":["// 获取全局应用程序实例对象\nconst app = getApp()\n\n// 创建页面实例对象\nPage({\n  /**\n   * 页面的初始数据\n   */\n  data: {\n    img: app.data.testImg,\n    labelIndex: 0\n  },\n  inputValue (e) {\n    this.data.searchText = e.detail.value\n  },\n  getVideo () {\n    let that = this\n    app.wxrequest({\n      url: app.getUrl().shopVideoList,\n      data: {},\n      success (res) {\n        wx.hideLoading()\n        wx.stopPullDownRefresh()\n        if (res.data.status === 200) {\n          that.setData({\n            list: res.data.data.lists\n          }, that.getCategory)\n        } else {\n          app.setToast(that, {content: res.data.desc})\n        }\n      }\n    })\n  },\n  getCategory () {\n    let that = this\n    app.wxrequest({\n      url: app.getUrl().shopCategoryList,\n      success (res) {\n        wx.hideLoading()\n        if (res.data.status === 200) {\n          that.setData({\n            goodslabel: res.data.data\n          }, that.shopInfo)\n          app.su('shopLabel', res.data.data)\n        } else {\n          app.setToast(that, {content: res.data.desc})\n        }\n      }\n    })\n  },\n  getShopProduct () {\n    if (this.data.noshop) return\n    let that = this\n    if (this.data.goodslabel[this.data.labelIndex].name === '搜索') return this.search()\n    app.wxrequest({\n      url: app.getUrl().shopProductList,\n      data: {\n        mid: 0,\n        cid: that.data.goodslabel[that.data.labelIndex].id\n      },\n      success (res) {\n        wx.hideLoading()\n        if (res.data.status === 200) {\n          that.setData({\n            goods: res.data.data.lists\n          })\n        } else {\n          app.setToast(that, {content: res.data.desc})\n        }\n      }\n    })\n  },\n  chooseLabel (e) {\n    this.setData({\n      goodslabel: this.data.goodslabel,\n      labelIndex: e.currentTarget.dataset.index\n    }, this.getShopProduct)\n  },\n  search () {\n    let that = this\n    if (!this.data.searchText || this.data.searchText.length <= 0) return app.setToast(this, {content: '请输入搜索的内容'})\n    app.wxrequest({\n      url: app.getUrl().shopProductList,\n      data: {\n        mid: 0,\n        title: that.data.searchText\n      },\n      success (res) {\n        wx.hideLoading()\n        if (res.data.status === 200) {\n          if (that.data.goodslabel[0].name !== '搜索') {\n            that.data.goodslabel.unshift({\n              name: '搜索'\n            })\n          }\n          that.setData({\n            labelIndex: 0,\n            goodslabel: that.data.goodslabel,\n            goods: res.data.data.lists\n          })\n        } else {\n          app.setToast(that, {content: res.data.desc})\n        }\n      }\n    })\n  },\n  shopInfo () {\n    let that = this\n    if (this.data.noshop) return\n    app.wxrequest({\n      url: app.getUrl().shopInfo,\n      data: {\n        mid: app.gs('shopInfo').mid || 1\n      },\n      success (res) {\n        wx.hideLoading()\n        if (res.data.status === 200) {\n          if (!app.gs('shopInfoAll')) {\n            app.su('shopInfoAll', res.data.data)\n          }\n          that.setData({\n            info: res.data.data\n          }, that.getShopProduct)\n        } else {\n          app.setToast(that, {content: res.data.desc})\n        }\n      }\n    })\n  },\n  upFormId (e) {\n    app.upFormId(e)\n  },\n  noUse () {\n    app.noUse()\n  },\n  playVideo (e) {\n    let that = this\n    if (e.currentTarget.dataset.index >= 0) app.videoCount(this.data.list[e.currentTarget.dataset.index].id)\n    this.setData({\n      play: !that.data.play,\n      playIndex: e.currentTarget.dataset.index\n    })\n  },\n  onShareAppMessage () {\n    let that = this\n    if (!app.gs('shopInfo').mid) {\n      return {\n        title: app.gs('shareText').t || '绣学问，真纹绣',\n        path: `/pages/index/index`,\n        imageUrl: app.gs('shareText').g\n      }\n    } else {\n      return {\n        title: `向您推荐店铺【${that.data.info.name}】`,\n        imageUrl: `${that.data.info.avatar || ''}`,\n        path: `/shopPage/shoppages/index/index?mid=${that.data.id}`\n      }\n    }\n  },\n  getUser () {\n    let that = this\n    app.wxrequest({\n      url: app.getUrl().shopUserInfo,\n      data: {\n        uid: app.gs('userInfoAll').id\n      },\n      success (res) {\n        wx.hideLoading()\n        if (res.data.status === 200) {\n          that.setData({\n            userInfo: res.data.data\n          })\n        } else {\n          app.setToast(that, {content: res.data.desc})\n        }\n      }\n    })\n  },\n  showTip () {\n    wx.showModal({\n      title: '未进入店铺',\n      content: '请扫码店主的【小程序码】或通过店主的【小程序分享】进入',\n      showCancel: false\n    })\n  },\n  /**\n   * 生命周期函数--监听页面加载\n   */\n  onLoad (options) {\n    if (!app.gs('shopInfo').mid) {\n      app.su('shopInfo', options)\n      if (!app.gs('shopInfo').mid) {\n        this.setData({\n          noshop: true\n        }, this.getUser)\n      } else {\n        this.setData({\n          noshop: false\n        })\n      }\n    }\n    if (!app.gs() || !app.gs('userInfoAll')) return app.wxlogin()\n    this.getVideo()\n  },\n\n  /**\n   * 生命周期函数--监听页面初次渲染完成\n   */\n  onReady () {\n  },\n\n  /**\n   * 生命周期函数--监听页面显示\n   */\n  onShow () {\n    this.setData({\n      move: !this.data.move\n    })\n  },\n\n  /**\n   * 生命周期函数--监听页面隐藏\n   */\n  onHide () {\n    this.setData({\n      move: !this.data.move\n    })\n  },\n\n  /**\n   * 生命周期函数--监听页面卸载\n   */\n  onUnload () {\n    // TODO: onUnload\n  },\n\n  /**\n   * 页面相关事件处理函数--监听用户下拉动作\n   */\n  onPullDownRefresh () {\n    this.getVideo()\n  }\n})\n"]}