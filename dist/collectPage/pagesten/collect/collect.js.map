{"version":3,"sources":["collectPage/pagesten/collect/collect.js"],"names":["app","getApp","Page","data","testImg","currentIndex","poster","page","lists","videoTab","t","onShareAppMessage","title","gs","path","imageUrl","g","showMore","e","setData","canShowIndex","currentTarget","dataset","index","goMapPoint","wx","openLocation","scale","chooseIndex","getUserBuyCourse","that","wxrequest","url","options","type","getUrl","userActive","userCollect","user_id","id","state","success","res","hideLoading","status","v","make_time","momentFormat","room_images","split","resLl","latitude","distance","longitude","toFixed","create_time","images","concat","more","pre_page","length","setToast","content","desc","onReachBottom","onLoad","getLocation","cur","setBar","onReady","onShow","onHide","onUnload","onPullDownRefresh"],"mappings":"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","file":"collect.js","sourcesContent":["// 获取全局应用程序实例对象\nconst app = getApp()\n\n// 创建页面实例对象\nPage({\n  /**\n   * 页面的初始数据\n   */\n  data: {\n    testImg: 'https://c.jiangwenqiang.com/api/logo.jpg',\n    currentIndex: 0,\n    poster: app.data.testImg,\n    page: 0,\n    lists: [],\n    videoTab: [\n      {\n        t: '未预约'\n      },\n      {\n        t: '进行中'\n      },\n      {\n        t: '已结束'\n      }\n    ]\n  },\n  onShareAppMessage () {\n    return {\n      title: app.gs('shareText').t || '绣学问，真纹绣',\n      path: `/pages/index/index`,\n      imageUrl: app.gs('shareText').g\n    }\n  },\n  showMore (e) {\n    this.setData({\n      canShowIndex: e.currentTarget.dataset.index\n    })\n  },\n  goMapPoint (e) {\n    wx.openLocation({\n      scale: 10,\n      ...(e.currentTarget.dataset)\n    })\n  },\n  chooseIndex (e) {\n    this.data.page = 0\n    this.data.lists = []\n    this.setData({\n      currentIndex: e.currentTarget.dataset.index\n    }, this.getUserBuyCourse)\n  },\n  getUserBuyCourse () {\n    let that = this\n    app.wxrequest({\n      url: that.data.options.type * 1 === 1 ? app.getUrl().userActive : app.getUrl().userCollect,\n      data: {\n        user_id: app.gs('userInfoAll').id,\n        page: ++that.data.page,\n        state: that.data.options.type * 1 === 1 ? that.data.currentIndex * 1 === 0 ? 3 : that.data.currentIndex : that.data.currentIndex * 1 + 1\n      },\n      success (res) {\n        wx.hideLoading()\n        if (res.data.status === 200) {\n          for (let v of res.data.data.lists) {\n            if (v.make_time) v.make_time = app.momentFormat(v.make_time * 1000, 'YYYY.MM.DD')\n            if (v.room_images) v.room_images = v.room_images.split(',')\n            if (that.data.resLl && v.latitude) {\n              let distance = app.distance(v.latitude, v.longitude, that.data.resLl.latitude, that.data.resLl.longitude)\n              v.distance = distance > 1000 ? (distance / 1000).toFixed(2) + 'km' : distance + 'm'\n            }\n            if (v.create_time) v.create_time = app.momentFormat(v.create_time * 1000, 'YYYY年MM月DD日 HH:mm:ss')\n            if (v.images) v.images = v.images.split(',')\n          }\n          that.setData({\n            lists: that.data.lists.concat(res.data.data.lists),\n            more: res.data.data.pre_page > res.data.data.lists.length ? 0 : 1\n          })\n        } else {\n          app.setToast(that, {content: res.data.desc})\n        }\n      }\n    })\n  },\n  onReachBottom () {\n    if (!this.data.more) return app.setToast(this, {content: '没有更多内容了'})\n    this.getUserBuyCourse()\n  },\n  /**\n   * 生命周期函数--监听页面加载\n   */\n  onLoad (options) {\n    let that = this\n    wx.getLocation({\n      success (res) {\n        that.setData({\n          resLl: res\n        })\n      }\n    })\n    this.setData({\n      options,\n      currentIndex: options.cur || 0\n    }, this.getUserBuyCourse)\n    if (options.type >= 2) {\n      this.setData({\n        videoTab: [\n          {\n            t: '教学视频'\n          },\n          {\n            t: '教室'\n          },\n          {\n            t: '线下课程'\n          },\n          {\n            t: '问答'\n          }\n        ]\n      })\n    }\n    app.setBar(options.type * 1 === 1 ? '我的预约' : '收藏')\n    // TODO: onLoad\n  },\n\n  /**\n   * 生命周期函数--监听页面初次渲染完成\n   */\n  onReady () {\n    // TODO: onReady\n  },\n\n  /**\n   * 生命周期函数--监听页面显示\n   */\n  onShow () {\n    // TODO: onShow\n  },\n\n  /**\n   * 生命周期函数--监听页面隐藏\n   */\n  onHide () {\n    // TODO: onHide\n  },\n\n  /**\n   * 生命周期函数--监听页面卸载\n   */\n  onUnload () {\n    // TODO: onUnload\n  },\n\n  /**\n   * 页面相关事件处理函数--监听用户下拉动作\n   */\n  onPullDownRefresh () {\n    this.data.page = 0\n    this.data.lists = []\n    this.getUserBuyCourse()\n    // TODO: onPullDownRefresh\n  }\n})\n"]}